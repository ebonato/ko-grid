/*
 Copyright (c) 2015, Ben Schulz
 License: BSD 3-clause (http://opensource.org/licenses/BSD-3-Clause)
*/
var w;
(function(B){"function"===typeof define&&define.amd?define(["require","knockout","ko-data-source","ko-indexed-repeat"],B):window["ko-grid"]=B(function(x,y){if(!Array.isArray(x)||1!==x.length||"string"!==typeof x[0]||"function"!==typeof y)throw Error("Assertion error.");var z=window.ko.bindingHandlers.grid.config=window.ko.bindingHandlers.grid.config||{};y(z[x[0]])},window.ko)})(function(B,x){var y,z,F,G,C,H,D;y=function(){var b;b=function(){function b(b,k){return Object.prototype.hasOwnProperty.call(b,k)}
return{fb:function(b,k){if(b===k)return!0;var g=!!k&&"function"===typeof k.valueOf;return!!b&&"function"===typeof b.valueOf&&g&&b.valueOf()===k.valueOf()},extend:function(b,k){Array.prototype.slice.call(arguments,1).forEach(function(g){for(var f=Object.keys(g),a=0,c=f.length;a<c;a++){var d=f[a],p=Object.getOwnPropertyDescriptor(g,d);p&&p.enumerable&&Object.defineProperty(b,d,p)}});return b},ka:function(h,k){for(var g in h)b(h,g)&&k(g,h[g])},B:b,Ab:function(h,k){var g={},f;for(f in h)b(h,f)&&(g[f]=
k(h[f],f,h));return g}}}();return function(b,n,k){return{h:b,c:n,R:k}}(function(b){function h(a){return a.filter(function(a,d,p){return p.lastIndexOf(a)===d})}function k(a,c){for(var d=a.length,p=-1,l=0;l<d;++l)if(c(a[l])){if(0<=p)throw Error("Multiple elements match the predicate.");p=l}return p}function g(a,c){return a&&"function"===typeof a.valueOf&&c&&"function"===typeof c.valueOf?a.valueOf()<=c.valueOf()?a.valueOf()<c.valueOf()?-1:0:1:a<=c?a<c?-1:0:1}function f(a,c){var d=a.length,p=Array(d),
l=Array(d),m;for(m=0;m<d;++m)p[m]=m,l[m]=a[m];m=a;a=l;l=m;p.sort(function(e,d){return c(a[e],a[d])||e-d});for(m=0;m<d;++m)l[m]=a[p[m]];return l}return{contains:function(a,c){return 0<=a.indexOf(c)},pb:function(a){if(50<a.length){for(var c=a.length,d={},p,l=0;l<c;++l)if(p=a[l],"string"===typeof p)if(b.B(d,p))break;else d[p]=!0;else if(a.lastIndexOf(p)!==l)break;if(!(l>=c)){for(var m=a.slice(0,l);l<c;++l)p=a[l],"string"===typeof p?b.B(d,p)||(d[p]=!0,m.push(p)):a.lastIndexOf(p)===l&&m.push(p);a=m}}else a=
h(a);return a},ja:function(a,c){return Array.prototype.concat.apply([],a.map(c))},Gb:function(a,c){var d=k(a,c);if(0>d)throw Error("None of the elements matches the predicate.");return a[d]},Hb:function(a,c){var d=k(a,c);return 0<=d?a[d]:null},Va:function(a,c){var d=c||g;window.chrome?d=f(a,d):(a.sort(d),d=a);return d}}}(b),b,{ya:function(b){return b.replace(/([A-Z])/g,function(b){return"-"+b.toLowerCase()})},lb:function(b){return b.replace(/-([a-z])/g,function(b){return b[1].toUpperCase()})},format:function(b){var h=
arguments;return b.replace(/{(\d+)}/g,function(b,g){var f=parseInt(g,10)+1;return typeof h.length<=f?b:h[f]})}})}();z=function(b,h){function n(b){var f={key:["char","charCode","key","keyCode"],mouse:"button buttons clientX clientY offsetX offsetY pageX pageY screenX screenY toElement".split(" ")},f="altKey bubbles cancelable ctrlKey currentTarget detail eventPhase metaKey relatedTarget shiftKey target timeStamp type view which".split(" ").concat(f[b.type.substr(0,3)]||[]).concat(f[b.type.substr(0,
5)]||[]);this.fa=b;this.b=b.defaultPrevented;f.forEach(function(a){return Object.defineProperty(this,a,{get:function(){return b[a]}})}.bind(this))}function k(b,f){this.la=b;this.Ua=f}n.prototype={preventDefault:function(){this.b=!0;return this.fa.preventDefault()},m:function(){this.b=!0},get defaultPrevented(){return this.b}};n.prototype=b.c.extend({},{get defaultPrevented(){return this.defaultPrevented},preventDefault:n.prototype.preventDefault,preventApplicationButAllowBrowserDefault:n.prototype.m},
n.prototype);return function(g){function f(c,d,p){function l(e){e=Array.prototype.slice.call(c.querySelectorAll(e)).filter(function(e){return h.Ha(e,d.target)});return e.length?e[e.length-1]:void 0}var m=h.Aa.bind(null,c),e=a.map(function(e){var a=e.Ua?l(e.Ua):c;return{la:e.la,match:a,depth:a?m(a):-1}}).filter(function(e){return!!e.match});b.h.Va(e,function(e,a){return a.depth-e.depth});e.forEach(function(e){e.la.apply(c,p)})}g=g||function(a){return[a]};var a=[];this.D=function(c,d){var b=1<arguments.length?
c:void 0;d=1<arguments.length?d:c;a.push(new k(d,b));return{dispose:function(){d&&(a.splice(a.indexOf(d),1),d=null)}}};this.oa=function(a){return{ha:function(d){var c=h.element.closest(d.target,a);c&&(d=new n(d),f(c,d,g(d,c)))}}}}}(y,function(){return function(){function b(b,g){return!!(b.compareDocumentPosition(g)&16)}var h=window.Element,n=h.prototype.webkitMatchesSelector||h.prototype.mozMatchesSelector||h.prototype.msMatchesSelector||h.prototype.matches;return{Aa:function(b,g){for(var f=0;g;){if(g===
b)return f;g=g.parentNode;++f}throw Error("The given node is not part of the subtree.");},Ha:function(h,g){return h===g||b(h,g)},Ib:b,element:{closest:function(b,g){do{if(n.call(b,g))return b;b=b.parentElement}while(b);return null},matches:function(b,g){return n.call(b,g)}}}}()}());F=function(){var b=/^[a-z]+(-[a-z]+)*$/,h=/\x3c!--(?:(before|after):)?([a-z]+(-[a-z]+)*)--\x3e*/g;return function(n){function k(b,c){c=c||function(a,e){return e+a};return function(l){var e=g(l,b);return{V:function(b,l){var m=
l?b:null,u=(l=l?l:b)?m:null,q=l,m=c;u&&a(u,2);f(q);u=u?g(u,3)+q+g(u,4):q;m=m(e,u);d=d.replace(e,m)}}}}function g(a,b){function d(e){if(c[a]!==e)throw Error("Operation is not defined for placeholder `"+a+"`.");}if(!c[a])throw Error("Unknown placeholder id `"+a+"`.");var e="\x3c!--"+a+"--\x3e",l="\x3c!--before:"+a+"--\x3e",f="\x3c!--after:"+a+"--\x3e";switch(b){case 1:return d(1),delete c[a],e;case 2:return d(1),e;case 3:return d(2),l;case 4:return d(2),f;case 5:case 6:return 1===c[a]?e:5===b?f:l}throw Error("Assertion error. Unkown operator: `"+
b+"`");}function f(b){for(var c;c=h.exec(b);){var d=c[1],e="before"===d;c=c[2];if(d&&1!==(b.match(new RegExp((e?"after":"before")+":"+c,"g"))||[]).length)throw Error("Multiple or unmatched before-/after-placeholders for placeholder id `"+c+"`.");d&&!e||a(c,d?2:1)}}function a(a,d){if(!b.test(a))throw Error("Invalid placeholder id `"+a+"`");if(c[a])throw Error("Placeholder id `"+a+"` is already taken.");c[a]=d}var c={},d=n;f(d);this.replace=function(a){return{qa:k(1,function(a,b){return b})(a).V}};
this.Wa=function(a){return{append:k(5)(a).V,Ra:k(6,function(a,b){return a+b})(a).V}};this.hb=function(){return d.replace(h,"")}}}();G=function(b,h,n){function k(b){return null===b?"":""+b}function g(f,a,c){this.id=this.id=c.id;this.property=this.C=c.property||this.id;this.userDefined=this.pa=!1!==c.pa;this.u=!c.hidden;this.visible=this.m=function(){return this.u}.bind(this);this.label=this.label=b.observable(c.label);this.width=this.width=b.observable(c.width);this.widthInPixels=this.Z=function(){var a=
this.width();if("px"!==a.substr(-2))throw Error("The only currently supported column width values are absolute pixel lengths.");return parseInt(a.substring(0,a.length-2),10)}.bind(this);this.Ea=b.observableArray(c.headerClasses||c.classes||[]);this.wa=b.observableArray(c.cellClasses||c.classes||[]);this.fa=b.observableArray(c.footerClasses||c.classes||[]);this.headerClasses=this.Ea;this.cellClasses=this.wa;this.footerClasses=this.fa;this.metadata=this.sb=a.columnMetadataSupplier?a.columnMetadataSupplier(f.gb,
c):{};this.renderValue=this.O=a.cellValueRenderer?a.cellValueRenderer.bind(void 0,this):k;this.tb=function(a){this.O=a(this.O)}.bind(this);this.b=function(a){a=this.sa(a,{g:this.da,update:this.ea});if(!a||!a.g||!a.update)throw Error("The cell value binding must define an `init` as well as an `update` method.");this.da=a.g;this.ea=a.update}.bind(this);this.sa=function(a,b){var c=a(h.c.extend({g:b.g,update:b.update},{init:b.g,update:b.update}));return{g:c.g||c.init,update:c.update||c.update}};this.overrideValueRendering=
this.tb;this.overrideValueBinding=this.b}b.bindingHandlers.__gridColumn={init:function(){},update:function(b,a){var c=a();b.style.width=c.width()}};return{g:function(b){b.replace("columns").qa(n)},v:function(f,a,c){function d(b){b=new g(c,a,b);a.columnInitializer&&a.columnInitializer(b);return b}this.all=this.all=b.observableArray(f.columns.map(d));this.byId=this.va=function(a){var b=this.Xa(a);if(!b)throw Error("The column id `"+a+"` is undefined.");return b}.bind(this);this.tryById=this.Xa=function(a){var b=
this.all().filter(function(b){return b.id===a});if(1<b.length)throw Error("Assertion error: Multiple columns with id `"+a+"`.");return b[0]}.bind(this);var h=b.observable(this.all().filter(function(a){return a.u}));this.displayed=this.l=function(){return h()};this.show=function(a){this.P(function(b){return b.u||b===a})}.bind(this);this.ub=function(a){this.P(function(b){return b.u&&b!==a})}.bind(this);this.show=this.show;this.hide=this.ub;this.reorder=this.Fb=function(a){var b=this.all().slice(),e=
[];a.forEach(function(a){b.splice(b.indexOf(a),1);e.push(a)});if(b.length)throw Error("The new column order must contain all columns.");this.all(e);this.P(function(a){return a.u})}.bind(this);this.showOnlyThoseWhich=this.P=function(a){var b=this.all();a=b.filter(a);b.forEach(function(a){a.u=!1});a.forEach(function(a){a.u=!0});h(a)}.bind(this);this.combinedWidth=this.jb=b.pureComputed(function(){for(var a=0,b=this.l(),e=0;e<b.length;++e)a+=b[e].Z();return a}.bind(this));this.add=this.add=function(a){a=
d({pa:!1,id:"$"+a.id,label:a.label,hidden:a.hidden||!1,width:a.width});this.all.unshift(a);this.P(function(a){return a.u});return a}.bind(this)}}}(x,y,'<colgroup class="ko-grid-colgroup">\r\n    <col class="ko-grid-col" data-bind="indexedRepeat: { forEach: columns.displayed, indexedBy: \'id\', as: \'column\' }" data-repeat-bind="__gridColumn: column()">\r\n</colgroup>');C=function(b){var h,n,k;h=function(b){return function(f,a){return b.c.extend(f,{get stringifyable(){return a()}})}}(b);n=function(b,
f){function a(){return 0}function c(a,b){return"string"===typeof a&&"string"===typeof b?a.localeCompare(b):a<=b?a<b?-1:0:1}function d(a,c){b.c.extend(a,{get onResultOf(){return this.N},get reverse(){return this.reverse},get callable(){return this.M}},{get N(){return function(b){return g(b,a)}},get reverse(){return function(){return c||h(a)}},get M(){return a}})}function g(a,b){function c(c,e){return b(a(c),a(e))}d(c);f(c,function(){return{type:"by-function-comparator","function":a.stringifyable,comparator:b.stringifyable}});
return c}function h(a){function b(b,c){return-a(b,c)}d(b,a);f(b,function(){return{type:"reversed-comparator",comparator:a.stringifyable}});return b}d(c);f(c,function(){return{type:"natural-comparator"}});d(a);f(a,function(){return{type:"indifferent-comparator"}});return{xb:a,Ub:c}}(b,h);k=function(b,f){function a(a){b.c.extend(a,{get callable(){return this.M}},{get M(){return a}})}return{Db:function(b){function c(a){return-1==b.indexOf(".")?a[b]:eval("owner."+b)}a(c);f(c,function(){return{type:"property-accessor",
propertyName:b}});return c}}}(b,h);b=function(b,f){function a(){return!0}function c(){return!1}function d(a,c){b.c.extend(a,{get and(){return this.L},get negate(){return this.Ka},get onResultOf(){return this.N},get or(){return this.Y},get callable(){return this.M}},{get L(){return function(b){return g([a,b])}},get Ka(){return function(){return c||k(a)}},get N(){return function(b){return h(b,a)}},get Y(){return function(b){return e([a,b])}},get M(){return a}})}function g(b){function c(a){for(var c=
0,e=b.length;c<e;++c)if(!b[c](a))return!1;return!0}if(!b.length)return a;d(c);f(c,function(){return{type:"and-predicate",components:b.map(function(a){return a.stringifyable})}});return c}function h(a,b){function c(c){return b(a(c))}d(c);f(c,function(){return{type:"by-function-predicate","function":a.stringifyable,predicate:b.stringifyable}});return c}function k(a){function b(b){return!a(b)}d(b,a);f(b,function(){return{type:"negated-predicate",predicate:a.stringifyable}});return b}function e(a){function b(b){for(var c=
0,e=a.length;c<e;++c)if(a[c](b))return!0;return!1}if(!a.length)return c;d(b);f(b,function(){return{type:"or-predicate",components:a.map(function(a){return a.stringifyable})}});return b}d(c);f(c,function(){return{type:"always-false-predicate"}});d(a);f(a,function(){return{type:"always-true-predicate"}});return{Rb:c,Sb:a,L:g,from:function(a,b){function c(b){return a(b)}d(c);f(c,b);return c},Y:e,Eb:function(a){function b(b){return a.test(b)}d(b);f(b,function(){return{type:"regular-expression-predicate",
regularExpression:a.source,caseSensitive:!a.ignoreCase,multiline:a.multiline}});return b}}}(b,h);return{I:n,U:k,o:b,zb:h,Jb:function(b,f){return"function"===typeof f||"object"===typeof f?f.stringifyable||f:f}}}(y);C=function(b,h,n,k,g){function f(a){this.s(function(b){b();this.G=a.element.querySelector(".ko-grid-tbody")}.bind(this));return function(){this.G=null}.bind(this)}function a(){var a=[],c={};this.rows=this.rows=c;c.l=b.observableArray([]);c.displayed=c.l;c.ia=b.observable(!1).extend({Wb:"always"});
c.displayedSynchronized=c.ia;c.__handleDisplayedRowsDeviate=function(){this.rows.ia(!1)}.bind(this);c.__handleDisplayedRowsSynchronized=function(){this.rows.ia(!0)}.bind(this);var e=this.view;c.__dirty=e.dirty;a.push(e.observables.subscribe(function(a){c.l(a)}));c.l(e.observables());var d=[];c.__classify=function(a){var b=d.map(function(b){return b(a)});return Array.prototype.concat.apply([],b)};c.Ga=function(a){d.push(a)};c.installClassifier=c.Ga;return function(){a.forEach(function(a){a.dispose()})}}
function c(){function a(a,c){var e=b.contextFor(c),d=e.row(),e=e.column(),f=-1==e.C.indexOf(".")?d[e.C]:eval("row."+e.C);return[a,f,d,e]}function c(a){return function(b){a.oa(".ko-grid-cell").ha(b);return!b.defaultPrevented}}var e=new k(a),d=new k(a),f=new k(a),g=new k(a);this.Cb=e.D.bind(e);this.La=d.D.bind(d);this.Ma=f.D.bind(f);this.Bb=g.D.bind(g);this.onCellMouseDown=this.Cb;this.onCellClick=this.La;this.onCellDoubleClick=this.Ma;this.onCellContextMenu=this.Bb;this.s(function(a){a();this.G.addEventListener("mousedown",
c(e));this.G.addEventListener("click",c(d));this.G.addEventListener("dblclick",c(f));this.G.addEventListener("contextmenu",c(g))}.bind(this));return function(){}}function d(a){function c(a,b){var c=a.children[b];if(!c)throw Error("Column `"+b+"` does not exist.");return c}function d(b,c,e){var d=b.row();v(d,function(b){var f=b.w,g=a.j.l().indexOf(f);e(b,c.children[g],d,f)})}var f=function(a){var b=this.G.querySelector("tr.ko-grid-row:nth-child("+(a+1)+")");if(!b)throw Error("Row `"+a+"` does not exist.");
return b}.bind(this),g=0,u={};this.rows.__handleElementRecycling=function(a,b){d(b,a,function(a,b,c,e){a.suspend();l(b,c,e)})};this.rows.__handleElementRecycled=function(a,b){d(b,a,function(a,b,c,e){a.resume(c,b);l(b,c,e);m(b,c,e)})};var v=function(c,e){if(g){var d=this.ma(b.unwrap(c[a.primaryKey]));h.c.B(u,d)&&u[d].forEach(e)}}.bind(this);this.cb=function(a,b){var c=a.row(),e=a.column();v(c,function(a){a.w===e&&b(a)})};this.lookupCell=this.Ja=function(d,v){function k(a){function b(){1===f.length?
delete u[A]:f.splice(f.indexOf(c),1);--g;if(!c.m){var a=c.element,b=c.b,e=c.w;c.suspend();l(a,b,e);m(a,b,e)}}if(r["__@__hijacked"])throw Error("Illegal state: This cell is already hijacked.");a=v.sa(a,{g:v.da||e,update:v.ea||q});var c=r["__@__hijacked"]=new p(r,d,v,a),f=u[A]=u[A]||[];f.push(c);++g;l(r,d,v);m(r,d,v);return h.c.extend({release:b,dispose:b},{dispose:b,release:b})}var A=this.ma(b.unwrap(d[a.primaryKey])),I=this.rows.l().tryFirstIndexOf(d),E=a.j.l().indexOf(v),r=c(f(I),E);return h.c.extend({element:r,
vb:k},{element:r,hijack:k})}.bind(this);return function(){}}function p(a,b,c,e){this.element=a;this.b=b;this.w=c;this.g=e.g;this.update=e.update}function l(a,c,d){for(var f=a["__@__hijacked"];a.firstChild;)b.removeNode(a.firstChild);(f&&f.g||d.da||e)(a,c,d)}function m(a,b,c){var e=-1==c.C.indexOf(".")?b[c.C]:eval("row."+c.C),d=a["__@__hijacked"],f=c.wa.peek().join(" ");a.className="ko-grid-td ko-grid-cell "+f;(d&&d.update||c.ea||q)(a,e,b,c)}function e(a){a.insertBefore(A.createTextNode(""),a.firstChild)}
function q(a,c,e,d){for(a=a.firstChild;a.nodeType!==E;)a=a.nextSibling;a.nodeValue=d.O(b.unwrap(c))}var E=window.Node.TEXT_NODE,A=window.document;p.prototype={get m(){return null===this.element},resume:function(a,b){this.element=b;this.b=a;b["__@__hijacked"]=this},suspend:function(){this.element=this.element["__@__hijacked"]=null}};b.bindingHandlers.__gridRow={init:function(){},update:function(a,b){var c=b(),e=c.classify,d=c.row(),c=1===c.index()%2?["ko-grid-tr","ko-grid-row","alternate"]:["ko-grid-tr",
"ko-grid-row"],e=e(d);a.className=c.concat(e).join(" ")}};b.bindingHandlers.__gridCell={init:function(a,b,c,e,d){b=b();var f=b.row;b=b.column;d.grid.data.cb(d,function(b){return b.resume(f(),a)});l(a,f,b());return{controlsDescendantBindings:!0}},update:function(a,b){var c=b(),e=c.row(),c=c.column.peek();m(a,e,c)}};return{g:function(a){a.replace("body").qa("body",g);a.Wa("table").Ra("<div class=\"ko-grid-load-indicator\" data-bind=\"style: { display: data.rows.__dirty() ? 'block' : 'none' }\">Loading&hellip;</div>")},
v:function(e,g,h){var l=[];this.source=e.dataSource;this.valueSelector=this.Mb=e.valueSelector||g.valueSelector||function(a){return b.unwrap(a)};this.observableValueSelector=this.ma=e.observableValueSelector||g.observableValueSelector||function(a){return a};this.predicates=this.o=b.observableArray(e.filters||[]);this.predicate=this.Qa=b.pureComputed(function(){return n.o.L(this.o().map(b.unwrap))}.bind(this));this.comparator=this.xa=b.observable(n.I.xb);this.offset=this.offset=b.observable(0);this.limit=
this.Ia=b.observable(Number.POSITIVE_INFINITY);e=this.source.openView(function(a){return a.filteredBy(this.Qa).sortedBy(this.xa).offsetBy(this.offset).limitedTo(this.Ia)}.bind(this));l.push(e.dispose.bind(e));this.view=this.view=e;this.K=function(){};this.s=function(a){var b=this.K;this.K=function(){a(b)}}.bind(this);l.push(f.call(this,h));l.push(a.call(this));l.push(c.call(this));l.push(d.call(this,h));this.H=function(){l.forEach(function(a){a()})}}}}(x,y,C,z,'<tbody class="ko-grid-tbody" data-bind="_gridWidth: columns.combinedWidth() + \'px\'">\r\n    <tr class="ko-grid-tr ko-grid-row"\r\n        data-bind="indexedRepeat: {\r\n            forEach: data.rows.displayed,\r\n            indexedBy: function(r) { return grid.data.observableValueSelector(ko.unwrap(r[grid.primaryKey])); },\r\n            as: \'row\',\r\n            at: \'rowIndex\',\r\n            beforeElementRecycling: data.rows.__handleElementRecycling,\r\n            afterElementRecycled: data.rows.__handleElementRecycled,\r\n            allowDeviation: true,\r\n            onDeviation: data.rows.__handleDisplayedRowsDeviate,\r\n            onSynchronization: data.rows.__handleDisplayedRowsSynchronized }"\r\n        data-repeat-bind="__gridRow: { classify: grid.data.rows.__classify, row: row, index: rowIndex }">\r\n\r\n        <td data-bind="indexedRepeat: { forEach: columns.displayed, indexedBy: \'id\', as: \'column\', allowElementRecycling: false }"\r\n            data-repeat-bind="__gridCell: { row: row, column: column }"></td>\r\n    </tr>\r\n</tbody>');
H=function(b,h,n,k){function g(a){this.id=this.id="column-header-"+a.id;this.element=this.element=b.observable(null);this.rowSpan=this.rowSpan=b.observable(1);this.columnSpan=this.A=b.observable(1);this.label=this.label=a.label;this.column=this.w=a;this.columns=this.j=[a];this.ba=function(a){this.rowSpan(a)}.bind(this)}function f(a){this.id=this.id="column-group-header-"+(a.id||"@__"+ ++m);this.element=this.element=b.observable(null);this.eb=a;this.rowSpan=this.rowSpan=b.observable(a.height);this.columnSpan=
this.A=b.observable(1);this.label=this.label=b.observable(a.label);this.columns=this.j=[];this.ba=function(a){this.j=[a];this.A(1)}.bind(this)}function a(a){function b(a){a.ib.forEach(function(b){var c=e[b];if(!c)e[b]=a;else if(c!==a)throw Error("Column `"+b+"` is element of column group `"+c.label+"` as well as `"+a.label+"`.");});a.T&&b(a.T)}var e={};h.h.ja(a,c.bind(this,null)).forEach(function(a){b(a)});return e}function c(a,b){var e=d(b),f=b.elements.filter(function(a){return"string"!==typeof a}),
g=b.elements.filter(function(a){return"string"===typeof a}),e={id:b.id,label:b.label,T:a,depth:a?a.depth+1:0,height:a?a.Pa-e:1,Pa:e,ib:g};return f.length?h.h.ja(f,c.bind(this,e)):e}function d(a){a=a.elements.filter(function(a){return"string"!==typeof a});return 1+Math.max.apply(Math,[0].concat(a.map(d)))}var p=window.document,l=window.Node,m=0;b.bindingHandlers.__gridHeader={init:function(a,c){var e=c()();e.element(a);b.utils.domNodeDisposal.addDisposeCallback(a,function(){e.element(null)});a.insertBefore(p.createTextNode(""),
a.firstChild);return{controlsDescendantBindings:!0}},update:function(a,b){var c=b()(),e=c.id.replace(/[\s]/g,"_");a.className=c.w?"ko-grid-th ko-grid-column-header "+e+" "+c.w.Ea().join(" "):"ko-grid-th ko-grid-column-group-header "+e;e=c.j.map(function(a){return a.Z()}).reduce(function(a,b){return a+b})+"px";a.style.width=e;a.style.maxWidth=e;a.rowSpan=c.rowSpan();a.colSpan=c.A();for(e=a.firstChild;e.nodeType!==l.TEXT_NODE;)e=e.nextSibling;e.nodeValue=c.label()}};return{g:function(a){a.replace("head").qa(k)},
v:function(c,d,h){function e(a,b,c){if(!a)return[];if(b[a.depth]&&b[a.depth].eb===a){var d=a;do{var g=b[d.depth];g.j.push(c);g.A(g.A()+1);d=d.T}while(d);return[]}b.length=a.depth;var d=e(a.T,b,c),h=g=a.depth;a=l(p,new f(a));a.ba(c);d[g]=b[h]=a;return d}function l(a,b){var c=b.id;return a[c]=a[c]||b}var k=a(c.columnGroups||[]),p={},m={},r=[];this.__rows=this.ca=b.computed(function(){var a=h.j.l(),c=0;a.forEach(function(a){a=k[a.id];c=Math.max(c,a?a.depth+a.Pa:0)});r.length=c+1;for(var d=0;d<r.length;++d)r[d]=
r[d]||b.observableArray(),r[d].__rowId="header-row-"+d,r[d].valueWillMutate(),r[d]().length=0;var f=[];a.forEach(function(a){var b=k[a.id],d=b?b.depth+b.height:0;f.length=d;var h=l(m,new g(a));h.ba(c-d+1);r[d]().push(h);a=e(b,f,a);for(b=0;b<a.length;++b)a[b]&&r[b]().push(a[b])});r.forEach(function(a){a.valueHasMutated()});return r});this.all=this.all=b.computed(function(){var a=[];this.ca().forEach(function(b){Array.prototype.push.apply(a,b())});return a}.bind(this));this.forColumn=this.Da=function(a){a=
"column-header-"+a.id;if(!Object.prototype.hasOwnProperty.call(m,a))throw Error("There is no header for the given column.");return m[a]};var q=new n(function(a,c){return[a,b.contextFor(c).header()]});this.__handleClick=function(a,b){q.oa(".ko-grid-column-header, .ko-grid-column-group-header").ha(b);return!b.defaultPrevented};this.Oa=q.D.bind(q);this.Na=function(a,b){function c(a,c){c instanceof g&&b.apply(this,arguments)}var e=1<arguments.length;b=e?b:a;q.D.apply(q,e?[a,c]:[c])};this.onHeaderClick=
this.Oa;this.onColumnHeaderClick=this.Na;this.H=function(){this.ca.dispose();this.all.dispose()}.bind(this)}}}(x,y,z,'<thead class="ko-grid-thead" data-bind="_gridWidth: columns.combinedWidth() + \'px\'">\r\n    \x3c!--before:headers--\x3e\r\n    <tr class="ko-grid-tr ko-grid-headers"\r\n        data-bind="indexedRepeat: { forEach: headers.__rows, indexedBy: \'__rowId\', as: \'headerRow\' }"\r\n        data-repeat-bind="click: headers.__handleClick">\r\n\r\n        <th class="ko-grid-th"\r\n            data-bind="indexedRepeat: { forEach: headerRow(), indexedBy: \'id\', as: \'header\' }"\r\n            data-repeat-bind="__gridHeader: header"></th>\r\n    </tr>\r\n    \x3c!--after:headers--\x3e\r\n</thead>');
D=function(b,h,n,k,g){b=b.bindingHandlers.grid=b.bindingHandlers.grid||{};return b.core=b.core||{columns:h,data:n,headers:k,layout:g}}(x,G,C,H,function(b){function h(b,f,a,c){var d=b.element,g=d.querySelector(".ko-grid-table-scroller-padding"),h=d.querySelector(".ko-grid-table-scroller"),k=d.querySelector(".ko-grid-thead"),e=d.querySelector(".ko-grid-tfoot"),n=!1;return function(b){if(!n)try{f(n=!0);var l=h.scrollLeft;b&&b();a.forEach(function(a){a.call(d)});g.style.borderTopWidth=Math.max(k.clientHeight,
0)+"px";g.style.borderBottomWidth=Math.max(e.clientHeight,0)+"px";h.scrollLeft=l;c.forEach(function(a){a.call(d)})}finally{f(!1),n=!1}}}function n(b){b=b.element;var f=b.querySelector(".ko-grid-table-scroller"),a=b.querySelector(".ko-grid-thead"),c=b.querySelector(".ko-grid-tfoot");f.addEventListener("scroll",function(){var b=-f.scrollLeft+"px";a.style.left=b;c.style.left=b})}var k=window.document;return{g:function(){},v:function(g,f,a){function c(a){a&&a()}var d=b.observable(!1);this.recalculate=
this.Ta=function(a){c(a)};var p=b.computed(function(){d()||(a.j.l().forEach(function(a){a.width()}),c())}),l=[],m=[];this.ua=function(a){l.push(a)};this.ta=function(a){m.push(a)};this.beforeRelayout=this.ua;this.afterRelayout=this.ta;this.K=function(){n.call(this,a);c=h(a,d,l,m);a.na(c)}.bind(this);this.determineCellDimensions=this.za=function(a){var b=k.createElement("div");b.className="ko-grid-td ko-grid-cell";b.appendChild("string"===typeof a?k.createTextNode(a):a);b.style.position="absolute";
b.style.visibility="hidden";k.body.appendChild(b);try{return{width:b.offsetWidth,height:b.offsetHeight}}finally{k.body.removeChild(b)}};this.H=function(){p.dispose()}}}}(x));(function(b,h){function n(a,b){if(h.c.B(f,a))throw Error("Extension id or alias already in use: `"+a+"`.");f[a]=b;b.aa.push(a);return b}function k(a,b){this.Sa=a;this.ga=b.dependencies||b.ga||[];this.Fa=b.initializer||b.Fa||function(){};this.v=b.Constructor||b.v;this.aa=[]}var g=b.bindingHandlers.grid=b.bindingHandlers.grid||
{},f=g.extensions=g.extensions||{};g.defineExtension=g.ob=function(a,b){return n(a,new k(a,b))};g.X=function(a){if(!h.c.B(f,a))throw Error("No known extension id or alias: `"+a+"`.");return f[a]};g.declareExtensionAlias=g.mb=function(a,b){return n(a,g.X(b))};g.declareExtensionAliases=g.nb=function(a,b){var c=g.X(b);a.forEach(function(a){return n(a,c)});return c};k.prototype={get yb(){return this.aa.slice()},Ca:function(a,b){var c=this.b(a,function(a){throw Error("Conflicting configurations "+a.map(function(a){return"`"+
a+"`"}).join(", ")+" (configuration: `"+b+"`).");});if(!c)throw Error("The extension `"+this.Sa+"` must be configured (configuration: `"+b+"`)");return a[c]},Lb:function(a){var b=this.b(a,function(a){throw Error("Conflicting binding values "+a.map(function(a){return"`"+a+"`"}).join(", ")+".");});return a[b]},b:function(a,b){var c=this.aa.filter(function(b){return h.c.B(a,b)});1<c.length&&b(c);return c[0]}};return f})(x,y);return function(b,h,n,k){function g(a,d){function e(){var b=m[a];d(b.kb,b.Kb,
b.qb)}m[a]?e():b([a],function(b){function d(e){e=c.X(e);var l=e.Sa,m=e.Ca(g,a);if(!n.h.contains(h,l)){if(n.h.contains(k,l))throw Error("Dependency cycle: .. -> "+k.join(" -> ")+" -> "+l+" -> ..");k.push(l);e.ga.forEach(d);e.Fa(f,m,b);h.push(k.pop())}}var f=new F('<div class="ko-grid">\r\n    \x3c!--before:grid--\x3e\r\n    <div class="ko-grid-table-container">\r\n        \x3c!--before:table--\x3e\r\n        <div class="ko-grid-table-scroller-padding">\r\n            <div class="ko-grid-table-scroller">\r\n                <table class="ko-grid-table" data-bind="_gridWidth: columns.combinedWidth() + \'px\'">\r\n                    \x3c!--columns--\x3e\r\n                    \x3c!--head--\x3e\r\n                    <tfoot class="ko-grid-tfoot" data-bind="_gridWidth: columns.combinedWidth() + \'px\'">\x3c!--tfoot--\x3e</tfoot>\r\n                    \x3c!--body--\x3e\r\n                </table>\r\n            </div>\r\n        </div>\r\n        \x3c!--after:table--\x3e\r\n    </div>\r\n    \x3c!--after:grid--\x3e\r\n</div>');
p.forEach(function(a){a.g(f,b)});var g=b.extensions||{},h=[],k=[];Object.keys(g).forEach(d);var q="ko-grid-template-"+a;l.b(q,f.hb());m[a]={kb:b,Kb:q,qb:h};e()})}function f(a,b){this.gb=b;this.primaryKey=this.primaryKey=b.primaryKey;this.rootElement=a;this.element=this.element=null;this.H=function(){};this.s=function(){};this.postApplyBindings=this.na=function(a){if(!this.s)throw Error("Illegal state: postApplyBindings-callbacks have been called already.");var b=this.s;this.s=function(){b();a()}}.bind(this);
var c=new k;this.b=c.D.bind(c);this["onKeyDown "]=this.b;a.addEventListener("keydown",function(a){c.oa(".ko-grid").ha(a);return!a.defaultPrevented})}var a=window.document,c=h.bindingHandlers.grid=h.bindingHandlers.grid||{},d=["columns","headers","data","layout"],p=d.map(function(a){return D[a]}),l=new h.nativeTemplateEngine;l.b=function(b,c){var d=a.createElement("script");d.id=b;d.type="text/html";d.text=c;a.querySelector("head").appendChild(d)};h.bindingHandlers.grid.init=function(a,b,k,m,p){function e(a){return"function"===
typeof a?a.apply(void 0,Array.prototype.slice.call(arguments,1)):a}var q=b(),u=q.config;g(u,function(b,g,k){var m=[],t=new f(a,q);h.utils.domNodeDisposal.addDisposeCallback(a,function(){t.H();m.forEach(function(a){a()})});n.c.ka(D,function(a,c){var d=new c.v(q,b,t);t[a]=d;t.j=t.columns;t.headers=t.headers;t.data=t.data;t.m=t.layout;"function"===typeof d.H&&m.push(d.H.bind(d))});var r=b.extensions,x=q.extensions||{},y=t.extensions=t.rb={};for(k.forEach(function(a){a=c.X(a);var d=a.Lb(x)||{},f=e(a.Ca(r,
u),d,q);if((!1!==f.enabled||!0===d.enabled)&&!1!==d.enabled){a.ga.forEach(function(a){if(!y[a])throw Error("Dependency '"+a+"' was disabled.");});var g=new a.v(d,f,t,q,b);a.yb.forEach(function(a){y[a]=g});"function"===typeof g.dispose&&m.push(g.dispose.bind(g))}});a.firstChild;)h.removeNode(a.firstChild);k=p.createChildContext(t,"grid");h.renderTemplate(g,k,{templateEngine:l},a);var v=a.querySelector(".ko-grid");t.element=v;t.element=v;n.c.ka(r,function(a){v.className+=" with-"+n.R.ya(a)});d.forEach(function(a){t[a].K&&
t[a].K()});t.s();t.s=null});return{controlsDescendantBindings:!0}};h.bindingHandlers.grid.update=function(){};var m={};h.bindingHandlers._gridWidth={init:function(){},update:function(a,b){var c=b();a.style.width=c;a.style.maxWidth=c}};return c}(B,x,y,z)});