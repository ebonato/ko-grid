/*
 Copyright (c) 2015, Ben Schulz
 License: BSD 3-clause (http://opensource.org/licenses/BSD-3-Clause)
*/
var v;
(function(B){"function"===typeof define&&define.amd?define(["require","knockout","ko-data-source","ko-indexed-repeat"],B):window["ko-grid"]=B(function(t,x){if(!Array.isArray(t)||1!==t.length||"string"!==typeof t[0]||"function"!==typeof x)throw Error("Assertion error.");var A=window.ko.bindingHandlers.grid.config=window.ko.bindingHandlers.grid.config||{};x(A[t[0]])},window.ko)})(function(B,t){var x=function(){var a=function(){function a(a,k){return Object.prototype.hasOwnProperty.call(a,k)}return{cb:function(a,k){if(a===
k)return!0;var e=!!k&&"function"===typeof k.valueOf;return!!a&&"function"===typeof a.valueOf&&e&&a.valueOf()===k.valueOf()},extend:function(a,k){Array.prototype.slice.call(arguments,1).forEach(function(e){for(var m=Object.keys(e),b=0,d=m.length;b<d;b++){var g=m[b],l=Object.getOwnPropertyDescriptor(e,g);void 0!==l&&l.enumerable&&Object.defineProperty(a,g,l)}});return a},ia:function(f,k){for(var e in f)a(f,e)&&k(e,f[e])},B:a,yb:function(f,k){var e={},m;for(m in f)a(f,m)&&(e[m]=k(f[m],m,f));return e}}}();
return function(a,n,k){return{h:a,c:n,P:k}}(function(a){function f(b){return b.filter(function(d,b,l){return l.lastIndexOf(d)===b})}function k(b,d){for(var g=b.length,l=-1,h=0;h<g;++h)if(d(b[h])){if(0<=l)throw Error("Multiple elements match the predicate.");l=h}return l}function e(b,d){return b&&"function"===typeof b.valueOf&&d&&"function"===typeof d.valueOf?b.valueOf()<=d.valueOf()?b.valueOf()<d.valueOf()?-1:0:1:b<=d?b<d?-1:0:1}function m(b,d,g){var l=b.length,h=Array(l),a=Array(l),c;for(c=0;c<l;++c)h[c]=
c,a[c]=b[c];!0===g&&(g=b,b=a,a=g);h.sort(function(c,g){return d(b[c],b[g])||c-g});for(c=0;c<l;++c)a[c]=b[h[c]];return a}return{contains:function(b,d){return 0<=b.indexOf(d)},nb:function(b){if(50<b.length){for(var d=b.length,g={},l,h=0;h<d;++h)if(l=b[h],"string"===typeof l)if(a.B(g,l))break;else g[l]=!0;else if(b.lastIndexOf(l)!==h)break;if(!(h>=d)){for(var e=b.slice(0,h);h<d;++h)l=b[h],"string"===typeof l?a.B(g,l)||(g[l]=!0,e.push(l)):b.lastIndexOf(l)===h&&e.push(l);b=e}}else b=f(b);return b},ha:function(b,
d){return Array.prototype.concat.apply([],b.map(d))},Eb:function(b,d){d=k(b,d);if(0>d)throw Error("None of the elements matches the predicate.");return b[d]},Fb:function(b,d){d=k(b,d);return 0<=d?b[d]:null},Ta:function(b,d){d=d||e;window.chrome?b=m(b,d,!0):b.sort(d);return b}}}(a),a,{wa:function(a){return a.replace(/([A-Z])/g,function(a){return"-"+a.toLowerCase()})},jb:function(a){return a.replace(/-([a-z])/g,function(a){return a[1].toUpperCase()})},format:function(a){var f=arguments;return a.replace(/{(\d+)}/g,
function(a,e){e=parseInt(e,10)+1;return typeof f.length<=e?a:f[e]})}})}();var A=function(a,f){function n(a){var e={key:["char","charCode","key","keyCode"],mouse:"button buttons clientX clientY offsetX offsetY pageX pageY screenX screenY toElement".split(" ")};e="altKey bubbles cancelable ctrlKey currentTarget detail eventPhase metaKey relatedTarget shiftKey target timeStamp type view which".split(" ").concat(e[a.type.substr(0,3)]||[]).concat(e[a.type.substr(0,5)]||[]);this.da=a;this.b=a.defaultPrevented;
e.forEach(function(b){return Object.defineProperty(this,b,{get:function(){return a[b]}})}.bind(this))}function k(a,m){this.ja=a;this.Sa=m}n.prototype={preventDefault:function(){this.b=!0;return this.da.preventDefault()},m:function(){this.b=!0},get defaultPrevented(){return this.b}};n.prototype=a.c.extend({},{get defaultPrevented(){return this.defaultPrevented},preventDefault:n.prototype.preventDefault,preventApplicationButAllowBrowserDefault:n.prototype.m},n.prototype);return function(e){function m(d,
g,l){function h(c){c=Array.prototype.slice.call(d.querySelectorAll(c)).filter(function(c){return f.Fa(c,g.target)});return c.length?c[c.length-1]:void 0}var e=f.ya.bind(null,d),c=b.map(function(c){var b=c.Sa?h(c.Sa):d;return{ja:c.ja,match:b,depth:b?e(b):-1}}).filter(function(c){return!!c.match});a.h.Ta(c,function(c,b){return b.depth-c.depth});c.forEach(function(c){c.ja.apply(d,l)})}e=e||function(b){return[b]};var b=[];this.D=function(d,a){var g=1<arguments.length?d:void 0;a=1<arguments.length?a:d;
b.push(new k(a,g));return{dispose:function(){a&&(b.splice(b.indexOf(a),1),a=null)}}};this.ma=function(b){return{fa:function(d){var a=f.element.closest(d.target,b);a&&(d=new n(d),m(a,d,e(d,a)))}}}}}(x,function(){return function(){function a(a,e){return!!(a.compareDocumentPosition(e)&16)}var f=window.Element,n=f.prototype.webkitMatchesSelector||f.prototype.mozMatchesSelector||f.prototype.msMatchesSelector||f.prototype.matches;return{ya:function(a,e){for(var m=0;e;){if(e===a)return m;e=e.parentNode;
++m}throw Error("The given node is not part of the subtree.");},Fa:function(f,e){return f===e||a(f,e)},Gb:a,element:{closest:function(a,e){do{if(n.call(a,e))return a;a=a.parentElement}while(a);return null},matches:function(a,e){return n.call(a,e)}}}}()}());var H=function(){var a=/^[a-z]+(-[a-z]+)*$/,f=/\x3c!--(?:(before|after):)?([a-z]+(-[a-z]+)*)--\x3e*/g;return function(n){function k(a,d){d=d||function(a,c){return c+a};return function(h){var c=e(h,a);return{U:function(a,h){var p=h?a:null;a=(h=h?
h:a)?p:null;p=h;h=d;a&&b(a,2);m(p);a=a?e(a,3)+p+e(a,4):p;h=h(c,a);g=g.replace(c,h)}}}}function e(a,b){function h(c){if(d[a]!==c)throw Error("Operation is not defined for placeholder `"+a+"`.");}if(!d[a])throw Error("Unknown placeholder id `"+a+"`.");var c="\x3c!--"+a+"--\x3e",p="\x3c!--before:"+a+"--\x3e",g="\x3c!--after:"+a+"--\x3e";switch(b){case 1:return h(1),delete d[a],c;case 2:return h(1),c;case 3:return h(2),p;case 4:return h(2),g;case 5:case 6:return 1===d[a]?c:5===b?g:p}throw Error("Assertion error. Unkown operator: `"+
b+"`");}function m(a){for(var d;d=f.exec(a);){var g=d[1],c="before"===g;d=d[2];if(g&&1!==(a.match(new RegExp((c?"after":"before")+":"+d,"g"))||[]).length)throw Error("Multiple or unmatched before-/after-placeholders for placeholder id `"+d+"`.");g&&!c||b(d,g?2:1)}}function b(b,g){if(!a.test(b))throw Error("Invalid placeholder id `"+b+"`");if(d[b])throw Error("Placeholder id `"+b+"` is already taken.");d[b]=g}var d={},g=n;m(g);this.replace=function(a){return{oa:k(1,function(a,b){return b})(a).U}};
this.Ua=function(a){return{append:k(5)(a).U,Pa:k(6,function(a,b){return a+b})(a).U}};this.fb=function(){return g.replace(f,"")}}}();var I=function(a,f,n){function k(a){return null===a?"":""+a}function e(e,b,d){this.id=this.id=d.id;this.property=this.C=d.property||this.id;this.userDefined=this.na=!1!==d.na;this.u=!d.hidden;this.visible=this.m=function(){return this.u}.bind(this);this.label=this.label=a.observable(d.label);this.width=this.width=a.observable(d.width);this.widthInPixels=this.X=function(){var a=
this.width();if("px"!==a.substr(-2))throw Error("The only currently supported column width values are absolute pixel lengths.");return parseInt(a.substring(0,a.length-2),10)}.bind(this);this.Ca=a.observableArray(d.headerClasses||d.classes||[]);this.ua=a.observableArray(d.cellClasses||d.classes||[]);this.da=a.observableArray(d.footerClasses||d.classes||[]);this.headerClasses=this.Ca;this.cellClasses=this.ua;this.footerClasses=this.da;this.metadata=this.qb=b.columnMetadataSupplier?b.columnMetadataSupplier(e.eb,
d):{};this.renderValue=this.N=b.cellValueRenderer?b.cellValueRenderer.bind(void 0,this):k;this.rb=function(a){this.N=a(this.N)}.bind(this);this.b=function(a){a=this.qa(a,{g:this.ba,update:this.ca});if(!a||!a.g||!a.update)throw Error("The cell value binding must define an `init` as well as an `update` method.");this.ba=a.g;this.ca=a.update}.bind(this);this.qa=function(a,b){a=a(f.c.extend({g:b.g,update:b.update},{init:b.g,update:b.update}));return{g:a.g||a.init,update:a.update||a.update}};this.overrideValueRendering=
this.rb;this.overrideValueBinding=this.b}a.bindingHandlers.__gridColumn={init:function(){},update:function(a,b){b=b();a.style.width=b.width()}};return{g:function(a){a.replace("columns").oa(n)},v:function(m,b,d){function g(a){a=new e(d,b,a);b.columnInitializer&&b.columnInitializer(a);return a}this.all=this.all=a.observableArray(m.columns.map(g));this.byId=this.ta=function(a){var b=this.Va(a);if(!b)throw Error("The column id `"+a+"` is undefined.");return b}.bind(this);this.tryById=this.Va=function(a){var b=
this.all().filter(function(c){return c.id===a});if(1<b.length)throw Error("Assertion error: Multiple columns with id `"+a+"`.");return b[0]}.bind(this);var f=a.observable(this.all().filter(function(a){return a.u}));this.displayed=this.l=function(){return f()};this.show=function(a){this.O(function(b){return b.u||b===a})}.bind(this);this.sb=function(a){this.O(function(b){return b.u&&b!==a})}.bind(this);this.show=this.show;this.hide=this.sb;this.reorder=this.Db=function(a){var b=this.all().slice(),c=
[];a.forEach(function(a){b.splice(b.indexOf(a),1);c.push(a)});if(b.length)throw Error("The new column order must contain all columns.");this.all(c);this.O(function(a){return a.u})}.bind(this);this.showOnlyThoseWhich=this.O=function(a){var b=this.all();a=b.filter(a);b.forEach(function(a){a.u=!1});a.forEach(function(a){a.u=!0});f(a)}.bind(this);this.combinedWidth=this.hb=a.pureComputed(function(){for(var a=0,b=this.l(),c=0;c<b.length;++c)a+=b[c].X();return a}.bind(this));this.add=this.add=function(a){a=
g({na:!1,id:"$"+a.id,label:a.label,hidden:a.hidden||!1,width:a.width});this.all.unshift(a);this.O(function(a){return a.u});return a}.bind(this)}}}(t,x,'<colgroup class="ko-grid-colgroup">\r\n    <col class="ko-grid-col" data-bind="indexedRepeat: { forEach: columns.displayed, indexedBy: \'id\', as: \'column\' }" data-repeat-bind="__gridColumn: column()">\r\n</colgroup>');var D=function(a){var f=function(a){return function(e,b){return a.c.extend(e,{get stringifyable(){return b()}})}}(a);var n=function(a,
f){function b(){return 0}function d(a,b){return"string"===typeof a&&"string"===typeof b?a.localeCompare(b):a<=b?a<b?-1:0:1}function e(b,c){return a.c.extend(b,{get onResultOf(){return this.M},get reverse(){return this.reverse},get callable(){return this.L}},{get M(){return function(a){return m(a,b)}},get reverse(){return function(){return c||h(b)}},get L(){return b}})}function m(a,b){function c(c,d){return b(a(c),a(d))}e(c);f(c,function(){return{type:"by-function-comparator","function":a.stringifyable,
comparator:b.stringifyable}});return c}function h(a){function b(b,c){return-a(b,c)}e(b,a);f(b,function(){return{type:"reversed-comparator",comparator:a.stringifyable}});return b}e(d);f(d,function(){return{type:"natural-comparator"}});e(b);f(b,function(){return{type:"indifferent-comparator"}});return{vb:b,Sb:d}}(a,f);var k=function(a,f){function b(b){return a.c.extend(b,{get callable(){return this.L}},{get L(){return b}})}return{Bb:function(a){function d(b){return-1==a.indexOf(".")?b[a]:eval("owner."+
a)}b(d);f(d,function(){return{type:"property-accessor",propertyName:a}});return d}}}(a,f);a=function(a,f){function b(){return!0}function d(){return!1}function e(b,d){return a.c.extend(b,{get and(){return this.and},get negate(){return this.Ia},get onResultOf(){return this.M},get or(){return this.or},get callable(){return this.L}},{get and(){return function(a){return l([b,a])}},get Ia(){return function(){return d||m(b)}},get M(){return function(a){return h(a,b)}},get or(){return function(a){return c([b,
a])}},get L(){return b}})}function l(a){function c(b){for(var c=0,d=a.length;c<d;++c)if(!a[c](b))return!1;return!0}if(!a.length)return b;e(c);f(c,function(){return{type:"and-predicate",components:a.map(function(a){return a.stringifyable})}});return c}function h(a,b){function c(c){return b(a(c))}e(c);f(c,function(){return{type:"by-function-predicate","function":a.stringifyable,predicate:b.stringifyable}});return c}function m(a){function b(b){return!a(b)}e(b,a);f(b,function(){return{type:"negated-predicate",
predicate:a.stringifyable}});return b}function c(a){function b(b){for(var c=0,d=a.length;c<d;++c)if(a[c](b))return!0;return!1}if(!a.length)return d;e(b);f(b,function(){return{type:"or-predicate",components:a.map(function(a){return a.stringifyable})}});return b}e(d);f(d,function(){return{type:"always-false-predicate"}});e(b);f(b,function(){return{type:"always-true-predicate"}});return{Pb:d,Qb:b,and:l,from:function(a,b){function c(b){return a(b)}e(c);f(c,b);return c},or:c,Cb:function(a){function b(b){return a.test(b)}
e(b);f(b,function(){return{type:"regular-expression-predicate",regularExpression:a.source,caseSensitive:!a.ignoreCase,multiline:a.multiline}});return b}}}(a,f);return{I:n,T:k,o:a,xb:f,Hb:function(a,f){return"function"===typeof f||"object"===typeof f?f.stringifyable||f:f}}}(x);D=function(a,f,n,k,e){function m(a){this.s(function(b){b();this.G=a.element.querySelector(".ko-grid-tbody")}.bind(this));return function(){this.G=null}.bind(this)}function b(){var b=[],c={};this.rows=this.rows=c;c.l=a.observableArray([]);
c.displayed=c.l;c.ga=a.observable(!1).extend({Ub:"always"});c.displayedSynchronized=c.ga;c.__handleDisplayedRowsDeviate=function(){this.rows.ga(!1)}.bind(this);c.__handleDisplayedRowsSynchronized=function(){this.rows.ga(!0)}.bind(this);var d=this.view;c.__dirty=d.dirty;b.push(d.observables.subscribe(function(a){c.l(a)}));c.l(d.observables());var e=[];c.__classify=function(a){var b=e.map(function(b){return b(a)});return Array.prototype.concat.apply([],b)};c.Ea=function(a){e.push(a)};c.installClassifier=
c.Ea;return function(){b.forEach(function(a){a.dispose()})}}function d(){function b(b,c){var d=a.contextFor(c);c=d.row();d=d.column();var e=-1==d.C.indexOf(".")?c[d.C]:eval("row."+d.C);return[b,e,c,d]}function c(a){return function(b){a.ma(".ko-grid-cell").fa(b);return!b.defaultPrevented}}var d=new k(b),e=new k(b),f=new k(b),g=new k(b);this.Ab=d.D.bind(d);this.Ja=e.D.bind(e);this.Ka=f.D.bind(f);this.zb=g.D.bind(g);this.onCellMouseDown=this.Ab;this.onCellClick=this.Ja;this.onCellDoubleClick=this.Ka;
this.onCellContextMenu=this.zb;this.s(function(a){a();this.G.addEventListener("mousedown",c(d));this.G.addEventListener("click",c(e));this.G.addEventListener("dblclick",c(f));this.G.addEventListener("contextmenu",c(g))}.bind(this));return function(){}}function g(b){function d(a,b){a=a.children[b];if(!a)throw Error("Column `"+b+"` does not exist.");return a}function e(a,c,d){var e=a.row();w(e,function(a){var f=a.w,g=b.j.l().indexOf(f);d(a,c.children[g],e,f)})}var g=function(a){var b=this.G.querySelector("tr.ko-grid-row:nth-child("+
(a+1)+")");if(!b)throw Error("Row `"+a+"` does not exist.");return b}.bind(this),C=0,k={};this.rows.__handleElementRecycling=function(a,b){e(b,a,function(a,b,c,d){a.suspend();h(b,c,d)})};this.rows.__handleElementRecycled=function(a,b){e(b,a,function(a,b,c,d){a.resume(c,b);h(b,c,d);u(b,c,d)})};var w=function(c,d){C&&(c=this.ka(a.unwrap(c[b.primaryKey])),f.c.B(k,c)&&k[c].forEach(d))}.bind(this);this.ab=function(a,b){var c=a.row(),d=a.column();w(c,function(a){a.w===d&&b(a)})};this.lookupCell=this.Ha=
function(e,w){function E(a){function b(){1===g.length?delete k[m]:g.splice(g.indexOf(d),1);--C;if(!d.m){var a=d.element,b=d.b,c=d.w;d.suspend();h(a,b,c);u(a,b,c)}}if(z["__@__hijacked"])throw Error("Illegal state: This cell is already hijacked.");a=w.qa(a,{g:w.ba||c,update:w.ca||p});var d=z["__@__hijacked"]=new l(z,e,w,a),g=k[m]=k[m]||[];g.push(d);++C;h(z,e,w);u(z,e,w);return f.c.extend({release:b,dispose:b},{dispose:b,release:b})}var m=this.ka(a.unwrap(e[b.primaryKey])),q=this.rows.l().tryFirstIndexOf(e),
r=b.j.l().indexOf(w),z=d(g(q),r);return f.c.extend({element:z,tb:E},{element:z,hijack:E})}.bind(this);return function(){}}function l(a,b,c,d){this.element=a;this.b=b;this.w=c;this.g=d.g;this.update=d.update}function h(b,d,e){for(var f=b["__@__hijacked"];b.firstChild;)a.removeNode(b.firstChild);(f&&f.g||e.ba||c)(b,d,e)}function u(a,b,c){var d=-1==c.C.indexOf(".")?b[c.C]:eval("row."+c.C),e=a["__@__hijacked"],f=c.ua.peek().join(" ");a.className="ko-grid-td ko-grid-cell "+f;(e&&e.update||c.ca||p)(a,d,
b,c)}function c(a){a.insertBefore(G.createTextNode(""),a.firstChild)}function p(b,c,d,e){for(b=b.firstChild;b.nodeType!==y;)b=b.nextSibling;b.nodeValue=e.N(a.unwrap(c))}var y=window.Node.TEXT_NODE,G=window.document;l.prototype={get m(){return null===this.element},resume:function(a,b){this.element=b;this.b=a;b["__@__hijacked"]=this},suspend:function(){this.element=this.element["__@__hijacked"]=null}};a.bindingHandlers.__gridRow={init:function(){},update:function(a,b){var c=b();b=c.classify;var d=c.row();
c=1===c.index()%2?["ko-grid-tr","ko-grid-row","alternate"]:["ko-grid-tr","ko-grid-row"];b=b(d);a.className=c.concat(b).join(" ")}};a.bindingHandlers.__gridCell={init:function(a,b,c,d,e){b=b();var f=b.row;b=b.column;e.grid.data.ab(e,function(b){return b.resume(f(),a)});h(a,f,b());return{controlsDescendantBindings:!0}},update:function(a,b){var c=b();b=c.row();c=c.column.peek();u(a,b,c)}};return{g:function(a){a.replace("body").oa("body",e);a.Ua("table").Pa("<div class=\"ko-grid-load-indicator\" data-bind=\"style: { display: data.rows.__dirty() ? 'block' : 'none' }\">Loading&hellip;</div>")},
v:function(c,e,f){var p=[];this.source=c.dataSource;this.valueSelector=this.Kb=c.valueSelector||e.valueSelector||function(b){return a.unwrap(b)};this.observableValueSelector=this.ka=c.observableValueSelector||e.observableValueSelector||function(a){return a};this.predicates=this.o=a.observableArray(c.filters||[]);this.predicate=this.Oa=a.pureComputed(function(){return n.o.and(this.o().map(a.unwrap))}.bind(this));this.comparator=this.va=a.observable(n.I.vb);this.offset=this.offset=a.observable(0);this.limit=
this.Ga=a.observable(Number.POSITIVE_INFINITY);c=this.source.openView(function(a){return a.filteredBy(this.Oa).sortedBy(this.va).offsetBy(this.offset).limitedTo(this.Ga)}.bind(this));p.push(c.dispose.bind(c));this.view=this.view=c;this.K=function(){};this.s=function(a){var b=this.K;this.K=function(){a(b)}}.bind(this);p.push(m.call(this,f));p.push(b.call(this));p.push(d.call(this));p.push(g.call(this,f));this.H=function(){p.forEach(function(a){a()})}}}}(t,x,D,A,'<tbody class="ko-grid-tbody" data-bind="_gridWidth: columns.combinedWidth() + \'px\'">\r\n    <tr class="ko-grid-tr ko-grid-row"\r\n        data-bind="indexedRepeat: {\r\n            forEach: data.rows.displayed,\r\n            indexedBy: function(r) { return grid.data.observableValueSelector(ko.unwrap(r[grid.primaryKey])); },\r\n            as: \'row\',\r\n            at: \'rowIndex\',\r\n            beforeElementRecycling: data.rows.__handleElementRecycling,\r\n            afterElementRecycled: data.rows.__handleElementRecycled,\r\n            allowDeviation: true,\r\n            onDeviation: data.rows.__handleDisplayedRowsDeviate,\r\n            onSynchronization: data.rows.__handleDisplayedRowsSynchronized }"\r\n        data-repeat-bind="__gridRow: { classify: grid.data.rows.__classify, row: row, index: rowIndex }">\r\n\r\n        <td data-bind="indexedRepeat: { forEach: columns.displayed, indexedBy: \'id\', as: \'column\', allowElementRecycling: false }"\r\n            data-repeat-bind="__gridCell: { row: row, column: column }"></td>\r\n    </tr>\r\n</tbody>');
var J=function(a,f,n,k){function e(b){this.id=this.id="column-header-"+b.id;this.element=this.element=a.observable(null);this.rowSpan=this.rowSpan=a.observable(1);this.columnSpan=this.A=a.observable(1);this.label=this.label=b.label;this.column=this.w=b;this.columns=this.j=[b];this.$=function(a){this.rowSpan(a)}.bind(this)}function m(b){this.id=this.id="column-group-header-"+(b.id||"@__"+ ++u);this.element=this.element=a.observable(null);this.bb=b;this.rowSpan=this.rowSpan=a.observable(b.height);this.columnSpan=
this.A=a.observable(1);this.label=this.label=a.observable(b.label);this.columns=this.j=[];this.$=function(a){this.j=[a];this.A(1)}.bind(this)}function b(a){function b(a){a.gb.forEach(function(b){var d=c[b];if(!d)c[b]=a;else if(d!==a)throw Error("Column `"+b+"` is element of column group `"+d.label+"` as well as `"+a.label+"`.");});a.S&&b(a.S)}var c={};f.h.ha(a,d.bind(this,null)).forEach(function(a){b(a)});return c}function d(a,b){var c=g(b),e=b.elements.filter(function(a){return"string"!==typeof a}),
h=b.elements.filter(function(a){return"string"===typeof a});a={id:b.id,label:b.label,S:a,depth:a?a.depth+1:0,height:a?a.Na-c:1,Na:c,gb:h};return e.length?f.h.ha(e,d.bind(this,a)):a}function g(a){a=a.elements.filter(function(a){return"string"!==typeof a});return 1+Math.max.apply(Math,[0].concat(a.map(g)))}var l=window.document,h=window.Node,u=0;a.bindingHandlers.__gridHeader={init:function(b,d){var c=d()();c.element(b);a.utils.domNodeDisposal.addDisposeCallback(b,function(){c.element(null)});b.insertBefore(l.createTextNode(""),
b.firstChild);return{controlsDescendantBindings:!0}},update:function(a,b){b=b()();var c=b.id.replace(/[\s]/g,"_");a.className=b.w?"ko-grid-th ko-grid-column-header "+c+" "+b.w.Ca().join(" "):"ko-grid-th ko-grid-column-group-header "+c;c=b.j.map(function(a){return a.X()}).reduce(function(a,b){return a+b})+"px";a.style.width=c;a.style.maxWidth=c;a.rowSpan=b.rowSpan();a.colSpan=b.A();for(a=a.firstChild;a.nodeType!==h.TEXT_NODE;)a=a.nextSibling;a.nodeValue=b.label()}};return{g:function(a){a.replace("head").oa(k)},
v:function(c,d,f){function g(a,b,c){if(!a)return[];if(b[a.depth]&&b[a.depth].bb===a){var d=a;do{var e=b[d.depth];e.j.push(c);e.A(e.A()+1);d=d.S}while(d);return[]}b.length=a.depth;d=g(a.S,b,c);var f=e=a.depth;a=h(k,new m(a));a.$(c);d[e]=b[f]=a;return d}function h(a,b){var c=b.id;return a[c]=a[c]||b}var l=b(c.columnGroups||[]),k={},p={},r=[];this.__rows=this.aa=a.computed(function(){var b=f.j.l(),c=0;b.forEach(function(a){a=l[a.id];c=Math.max(c,a?a.depth+a.Na:0)});r.length=c+1;for(var d=0;d<r.length;++d)r[d]=
r[d]||a.observableArray(),r[d].__rowId="header-row-"+d,r[d].valueWillMutate(),r[d]().length=0;var k=[];b.forEach(function(a){var b=l[a.id],d=b?b.depth+b.height:0;k.length=d;var f=h(p,new e(a));f.$(c-d+1);r[d]().push(f);a=g(b,k,a);for(b=0;b<a.length;++b)a[b]&&r[b]().push(a[b])});r.forEach(function(a){a.valueHasMutated()});return r});this.all=this.all=a.computed(function(){var a=[];this.aa().forEach(function(b){Array.prototype.push.apply(a,b())});return a}.bind(this));this.forColumn=this.Ba=function(a){a=
"column-header-"+a.id;if(!Object.prototype.hasOwnProperty.call(p,a))throw Error("There is no header for the given column.");return p[a]};var y=new n(function(b,c){return[b,a.contextFor(c).header()]});this.__handleClick=function(a,b){y.ma(".ko-grid-column-header, .ko-grid-column-group-header").fa(b);return!b.defaultPrevented};this.Ma=y.D.bind(y);this.La=function(a,b){function c(a,c){c instanceof e&&b.apply(this,arguments)}var d=1<arguments.length;b=d?b:a;y.D.apply(y,d?[a,c]:[c])};this.onHeaderClick=
this.Ma;this.onColumnHeaderClick=this.La;this.H=function(){this.aa.dispose();this.all.dispose()}.bind(this)}}}(t,x,A,'<thead class="ko-grid-thead" data-bind="_gridWidth: columns.combinedWidth() + \'px\'">\r\n    \x3c!--before:headers--\x3e\r\n    <tr class="ko-grid-tr ko-grid-headers"\r\n        data-bind="indexedRepeat: { forEach: headers.__rows, indexedBy: \'__rowId\', as: \'headerRow\' }"\r\n        data-repeat-bind="click: headers.__handleClick">\r\n\r\n        <th class="ko-grid-th"\r\n            data-bind="indexedRepeat: { forEach: headerRow(), indexedBy: \'id\', as: \'header\' }"\r\n            data-repeat-bind="__gridHeader: header"></th>\r\n    </tr>\r\n    \x3c!--after:headers--\x3e\r\n</thead>');
var F=function(a,f,n,k,e){a=a.bindingHandlers.grid=a.bindingHandlers.grid||{};return a.core=a.core||{columns:f,data:n,headers:k,layout:e}}(t,I,D,J,function(a){function f(a,f,b,d){var e=a.element,k=e.querySelector(".ko-grid-table-scroller-padding"),h=e.querySelector(".ko-grid-table-scroller"),m=e.querySelector(".ko-grid-thead"),c=e.querySelector(".ko-grid-tfoot"),p=!1;return function(a){if(!p)try{f(p=!0);var g=h.scrollLeft;a&&a();b.forEach(function(a){a.call(e)});k.style.borderTopWidth=Math.max(m.clientHeight,
0)+"px";k.style.borderBottomWidth=Math.max(c.clientHeight,0)+"px";h.scrollLeft=g;d.forEach(function(a){a.call(e)})}finally{f(!1),p=!1}}}function n(a){a=a.element;var e=a.querySelector(".ko-grid-table-scroller"),b=a.querySelector(".ko-grid-thead"),d=a.querySelector(".ko-grid-tfoot");e.addEventListener("scroll",function(){var a=-e.scrollLeft+"px";b.style.left=a;d.style.left=a})}var k=window.document;return{g:function(){},v:function(e,m,b){function d(a){a&&a()}var g=a.observable(!1);this.recalculate=
this.Ra=function(a){d(a)};var l=a.computed(function(){g()||(b.j.l().forEach(function(a){a.width()}),d())}),h=[],u=[];this.sa=function(a){h.push(a)};this.ra=function(a){u.push(a)};this.beforeRelayout=this.sa;this.afterRelayout=this.ra;this.K=function(){n.call(this,b);d=f(b,g,h,u);b.la(d)}.bind(this);this.determineCellDimensions=this.xa=function(a){var b=k.createElement("div");b.className="ko-grid-td ko-grid-cell";b.appendChild("string"===typeof a?k.createTextNode(a):a);b.style.position="absolute";
b.style.visibility="hidden";k.body.appendChild(b);try{return{width:b.offsetWidth,height:b.offsetHeight}}finally{k.body.removeChild(b)}};this.H=function(){l.dispose()}}}}(t));(function(a,f){function n(a,d){if(f.c.B(m,a))throw Error("Extension id or alias already in use: `"+a+"`.");m[a]=d;d.Z.push(a);return d}function k(a,d){this.Qa=a;this.ea=d.dependencies||d.ea||[];this.Da=d.initializer||d.Da||function(){};this.v=d.Constructor||d.v;this.Z=[]}var e=a.bindingHandlers.grid=a.bindingHandlers.grid||{},
m=e.extensions=e.extensions||{};e.defineExtension=e.mb=function(a,d){return n(a,new k(a,d))};e.W=function(a){if(!f.c.B(m,a))throw Error("No known extension id or alias: `"+a+"`.");return m[a]};e.declareExtensionAlias=e.kb=function(a,d){return n(a,e.W(d))};e.declareExtensionAliases=e.lb=function(a,d){var b=e.W(d);a.forEach(function(a){return n(a,b)});return b};k.prototype={get wb(){return this.Z.slice()},Aa:function(a,d){var b=this.b(a,function(a){throw Error("Conflicting configurations "+a.map(function(a){return"`"+
a+"`"}).join(", ")+" (configuration: `"+d+"`).");});if(!b)throw Error("The extension `"+this.Qa+"` must be configured (configuration: `"+d+"`)");return a[b]},Jb:function(a){var b=this.b(a,function(a){throw Error("Conflicting binding values "+a.map(function(a){return"`"+a+"`"}).join(", ")+".");});return a[b]},b:function(a,d){var b=this.Z.filter(function(b){return f.c.B(a,b)});1<b.length&&d(b);return b[0]}};return m})(t,x);return function(a,f,n,k){function e(b,e){function c(){var a=u[b];e(a.ib,a.Ib,
a.ob)}if(u[b])return c();a([b],function(a){function e(c){c=d.W(c);var h=c.Qa,l=c.Aa(g,b);if(!n.h.contains(k,h)){if(n.h.contains(m,h))throw Error("Dependency cycle: .. -> "+m.join(" -> ")+" -> "+h+" -> ..");m.push(h);c.ea.forEach(e);c.Da(f,l,a);k.push(m.pop())}}var f=new H('<div class="ko-grid">\r\n    \x3c!--before:grid--\x3e\r\n    <div class="ko-grid-table-container">\r\n        \x3c!--before:table--\x3e\r\n        <div class="ko-grid-table-scroller-padding">\r\n            <div class="ko-grid-table-scroller">\r\n                <table class="ko-grid-table" data-bind="_gridWidth: columns.combinedWidth() + \'px\'">\r\n                    \x3c!--columns--\x3e\r\n                    \x3c!--head--\x3e\r\n                    <tfoot class="ko-grid-tfoot" data-bind="_gridWidth: columns.combinedWidth() + \'px\'">\x3c!--tfoot--\x3e</tfoot>\r\n                    \x3c!--body--\x3e\r\n                </table>\r\n            </div>\r\n        </div>\r\n        \x3c!--after:table--\x3e\r\n    </div>\r\n    \x3c!--after:grid--\x3e\r\n</div>');
l.forEach(function(b){b.g(f,a)});var g=a.extensions||{},k=[],m=[];Object.keys(g).forEach(e);var p="ko-grid-template-"+b;h.b(p,f.fb());u[b]={ib:a,Ib:p,ob:k};c()})}function m(a,b){this.eb=b;this.primaryKey=this.primaryKey=b.primaryKey;this.rootElement=a;this.element=this.element=null;this.H=function(){};this.s=function(){};this.postApplyBindings=this.la=function(a){if(!this.s)throw Error("Illegal state: postApplyBindings-callbacks have been called already.");var b=this.s;this.s=function(){b();a()}}.bind(this);
var c=new k;this.b=c.D.bind(c);this["onKeyDown "]=this.b;a.addEventListener("keydown",function(a){c.ma(".ko-grid").fa(a);return!a.defaultPrevented})}var b=window.document,d=f.bindingHandlers.grid=f.bindingHandlers.grid||{},g=["columns","headers","data","layout"],l=g.map(function(a){return F[a]}),h=new f.nativeTemplateEngine;h.b=function(a,d){var c=b.createElement("script");c.id=a;c.type="text/html";c.text=d;b.querySelector("head").appendChild(c)};f.bindingHandlers.grid.init=function(a,b,k,l,u){function c(a){return"function"===
typeof a?a.apply(void 0,Array.prototype.slice.call(arguments,1)):a}var p=b(),t=p.config;e(t,function(b,e,k){var l=[],q=new m(a,p);f.utils.domNodeDisposal.addDisposeCallback(a,function(){q.H();l.forEach(function(a){a()})});n.c.ia(F,function(a,c){c=new c.v(p,b,q);q[a]=c;q.j=q.columns;q.headers=q.headers;q.data=q.data;q.m=q.layout;"function"===typeof c.H&&l.push(c.H.bind(c))});var r=b.extensions,x=p.extensions||{},w=q.extensions=q.pb={};for(k.forEach(function(a){a=d.W(a);var e=a.Jb(x)||{},f=c(a.Aa(r,
t),e,p);if((!1!==f.enabled||!0===e.enabled)&&!1!==e.enabled){a.ea.forEach(function(a){if(!w[a])throw Error("Dependency '"+a+"' was disabled.");});var g=new a.v(e,f,q,p,b);a.wb.forEach(function(a){w[a]=g});"function"===typeof g.dispose&&l.push(g.dispose.bind(g))}});a.firstChild;)f.removeNode(a.firstChild);k=u.createChildContext(q,"grid");f.renderTemplate(e,k,{templateEngine:h},a);var y=a.querySelector(".ko-grid");q.element=y;q.element=y;n.c.ia(r,function(a){y.className+=" with-"+n.P.wa(a)});g.forEach(function(a){q[a].K&&
q[a].K()});q.s();q.s=null});return{controlsDescendantBindings:!0}};f.bindingHandlers.grid.update=function(){};var u={};f.bindingHandlers._gridWidth={init:function(){},update:function(a,b){b=b();a.style.width=b;a.style.maxWidth=b}};return d}(B,t,x,A)});